<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
   <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
   <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

<nav class="navbar navbar-default navbar-fixed-top">
<div class="container">
	<div class="navbar-header">
		<a href="#" id="popover" class="navbar-toggle collapsed"><span class="glyphicon glyphicon-search"></span></a>
		<div id="popover-head" class="hide">Filter Results</div>
		<div id="popover-content" class="hide">
			<form id="search_form" onsubmit="transformFormData();">
				<div class="form-group">
				  <label for="searchterm">Search:</label>
				  <input type="text" class="form-control" id="searchterm">
				</div>
				<div class="form-group">
				  	<label for="day">Day(s):</label>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="d1">Monday, Sept. 9</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="d2">Wednesday, Sept. 11</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="d3">Thursday, Sept. 12</label>
					</div>
				</div>
				<div class="form-group">
				  	<label for="major">Major(s):</label>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="m1">ABC</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="m2">DEF</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="m3">GHI</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="m4">JKL</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="m5">MNO</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="m6">PQR</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="m7">STU</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="m8">VWX</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="m9">YZ1</label>
					</div>
				</div>
				<div class="form-group">
				  	<label for="position">Position(s):</label>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="p1">Internship</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="p2">Full-Time</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="p3">Part-Time</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="p4">Co-Op</label>
					</div>
				</div>
				<div class="form-group">
				  	<label for="citizenship">Citizenship:</label>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="c1">Citizen</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="c2">Resident</label>
					</div>
					<div class="checkbox">
					  <label><input type="checkbox" value="" id="c3">Greencard</label>
					</div>
				</div>
				<div class="form-group">
					<div class="col-xs-6">
					  <input class="btn btn-danger" type="submit" value="Clear Filters" onclick="submitForm(0, '');">
					</div>
					<div class="col-xs-6">
					  <input class="btn btn-primary" type="submit" value="Submit">
					</div>
				</div>
			</form>
		</div>
		<a href="index.php" class="navbar-brand">
			<span class="glyphicon glyphicon-calendar"></span> Fall 2016 Career Fair
		</a>
	</div>
</div>
</nav>

<script type="text/javascript">
$('#popover').popover({ 
    placement: 'left',
    html : true,
    title: function() {
      return $("#popover-head").html();
    },
    content: function() {
      return $("#popover-content").html();
    }
});

function transformFormData() {

    var searchterm = document.getElementById("search_form").elements["searchterm"].value;    

    var attribute_int = 0;
    var attributes = document.getElementById("search_form").elements;

    //iterate through form elements (excluding first and last 2 because those are searchterm, submit, and clear). If checked, append a 1 to the bitmask; else, 0.
    //TODO: separate logic for the different form groups for better/insuitive results
    for ( var i = 1; i < attributes.length-2; i++ ) {
	attribute_int = (attribute_int << 1);	
	if ( attributes[i].checked ) {
		attribute_int = (attribute_int | 1);
	}
    }

    submitForm(attribute_int, searchterm);

    return false;
}

function submitForm(attribute_int, searchterm) {

    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            location.reload();
    }
    xmlHttp.open("GET", "../sandbox/capture_attr.php?attributes="+attribute_int+"&searchterm="+searchterm, true); // true for asynchronous 
    xmlHttp.send(null);

    return false;
}
</script>
